# proper_measure_robustness
Codes for the paper [Proper Measure for Adversarial Robustness](https://arxiv.org/abs/2005.02540)



## `2D_1nn_ensemble.py`: plot speculated optimally robust classifiers when data contain input noise. 
* By changing `p_ord` (default: 1), it is possible to choose different distance metric (only <a href="https://www.codecogs.com/eqnedit.php?latex=\dpi{150}&space;\small&space;l_p" target="_blank"><img src="https://latex.codecogs.com/svg.latex?\dpi{150}&space;\small&space;l_p" title="\small l_p" /></a> norms with <a href="https://www.codecogs.com/eqnedit.php?latex=\dpi{150}&space;\small&space;p=1,2,&space;\infty" target="_blank"><img src="https://latex.codecogs.com/svg.latex?\dpi{150}&space;\small&space;p=1,2,&space;\infty" title="\small p=1,2, \infty" /></a>).
* Different examples are available by uncommenting and commenting the data definition part.
* By changing `swc_gradual` (default: 0),  it is possible to plot results using gradual nearest neighbor (1-NN) classifiers. 
* `n_noise` decides the number of classifiers will be used for getting ensemble classifiers. Using large `n_noise` will give smooth ensemble classifiers, but it takes much time.

### Speculated optimally robust classifiers when data contain input noise
|  | <a href="https://www.codecogs.com/eqnedit.php?latex=\dpi{150}&space;\small&space;\sigma&space;=&space;0" target="_blank"><img src="https://latex.codecogs.com/svg.latex?\dpi{150}&space;\small&space;\sigma&space;=&space;0" title="\small \sigma = 0" /></a> | <a href="https://www.codecogs.com/eqnedit.php?latex=\dpi{150}&space;\small&space;\sigma&space;=&space;0.25" target="_blank"><img src="https://latex.codecogs.com/svg.latex?\dpi{150}&space;\small&space;\sigma&space;=&space;0.25" title="\small \sigma = 0.25" /></a> | <a href="https://www.codecogs.com/eqnedit.php?latex=\dpi{150}&space;\small&space;\sigma&space;=&space;0.5" target="_blank"><img src="https://latex.codecogs.com/svg.latex?\dpi{150}&space;\small&space;\sigma&space;=&space;0.5" title="\small \sigma = 0.5" /></a> | <a href="https://www.codecogs.com/eqnedit.php?latex=\dpi{150}&space;\small&space;\sigma&space;=&space;0.75" target="_blank"><img src="https://latex.codecogs.com/svg.latex?\dpi{150}&space;\small&space;\sigma&space;=&space;0.75" title="\small \sigma = 0.75" /></a> | <a href="https://www.codecogs.com/eqnedit.php?latex=\dpi{150}&space;\small&space;\sigma&space;=&space;1" target="_blank"><img src="https://latex.codecogs.com/svg.latex?\dpi{150}&space;\small&space;\sigma&space;=&space;1" title="\small \sigma = 1" /></a> |
| :---:         |     :---:      |   :---:   | :---:         |     :---:      |   :---:   |
| <a href="https://www.codecogs.com/eqnedit.php?latex=\dpi{150}&space;\small&space;\l_{1}" target="_blank"><img src="https://latex.codecogs.com/svg.latex?\dpi{150}&space;\small&space;\l_{1}" title="\small \l_{1}" /></a> norm | <img src="https://github.com/hjk92g/proper_measure_robustness/blob/master/results/Classifier_l1.png" width="145" height="145" /> | <img src="https://github.com/hjk92g/proper_measure_robustness/blob/master/results/Classifier_l1_1.png" width="145" height="145" /> |   <img src="https://github.com/hjk92g/proper_measure_robustness/blob/master/results/Classifier_l1_2.png" width="145" height="145" />   | <img src="https://github.com/hjk92g/proper_measure_robustness/blob/master/results/Classifier_l1_3.png" width="145" height="145" /> | <img src="https://github.com/hjk92g/proper_measure_robustness/blob/master/results/Classifier_l1_4.png" width="145" height="145" /> |
| <a href="https://www.codecogs.com/eqnedit.php?latex=\dpi{150}&space;\small&space;\l_{2}" target="_blank"><img src="https://latex.codecogs.com/svg.latex?\dpi{150}&space;\small&space;\l_{2}" title="\small \l_{2}" /></a> norm | <img src="https://github.com/hjk92g/proper_measure_robustness/blob/master/results/Classifier_l2.png" width="145" height="145" /> | <img src="https://github.com/hjk92g/proper_measure_robustness/blob/master/results/Classifier_l2_1.png" width="145" height="145" /> | <img src="https://github.com/hjk92g/proper_measure_robustness/blob/master/results/Classifier_l2_2.png" width="145" height="145" /> | <img src="https://github.com/hjk92g/proper_measure_robustness/blob/master/results/Classifier_l2_3.png" width="145" height="145" /> | <img src="https://github.com/hjk92g/proper_measure_robustness/blob/master/results/Classifier_l2_4.png" width="145" height="145" /> |
| <a href="https://www.codecogs.com/eqnedit.php?latex=\dpi{150}&space;\small&space;\l_{\infty}" target="_blank"><img src="https://latex.codecogs.com/svg.latex?\dpi{150}&space;\small&space;\l_{\infty}" title="\small \l_{\infty}" /></a> norm | <img src="https://github.com/hjk92g/proper_measure_robustness/blob/master/results/Classifier_linf.png" width="145" height="145" />  | <img src="https://github.com/hjk92g/proper_measure_robustness/blob/master/results/Classifier_linf_1.png" width="145" height="145" /> | <img src="https://github.com/hjk92g/proper_measure_robustness/blob/master/results/Classifier_linf_2.png" width="145" height="145" /> | <img src="https://github.com/hjk92g/proper_measure_robustness/blob/master/results/Classifier_linf_3.png" width="145" height="145" /> | <img src="https://github.com/hjk92g/proper_measure_robustness/blob/master/results/Classifier_linf_4.png" width="145" height="145" /> |

### Speculated optimally robust classifiers combined with the gradual nearest neighbor classifiers when data contain input noise 
|  | <a href="https://www.codecogs.com/eqnedit.php?latex=\dpi{150}&space;\small&space;\sigma&space;=&space;0" target="_blank"><img src="https://latex.codecogs.com/svg.latex?\dpi{150}&space;\small&space;\sigma&space;=&space;0" title="\small \sigma = 0" /></a> | <a href="https://www.codecogs.com/eqnedit.php?latex=\dpi{150}&space;\small&space;\sigma&space;=&space;0.25" target="_blank"><img src="https://latex.codecogs.com/svg.latex?\dpi{150}&space;\small&space;\sigma&space;=&space;0.25" title="\small \sigma = 0.25" /></a> | <a href="https://www.codecogs.com/eqnedit.php?latex=\dpi{150}&space;\small&space;\sigma&space;=&space;0.5" target="_blank"><img src="https://latex.codecogs.com/svg.latex?\dpi{150}&space;\small&space;\sigma&space;=&space;0.5" title="\small \sigma = 0.5" /></a> | <a href="https://www.codecogs.com/eqnedit.php?latex=\dpi{150}&space;\small&space;\sigma&space;=&space;0.75" target="_blank"><img src="https://latex.codecogs.com/svg.latex?\dpi{150}&space;\small&space;\sigma&space;=&space;0.75" title="\small \sigma = 0.75" /></a> | <a href="https://www.codecogs.com/eqnedit.php?latex=\dpi{150}&space;\small&space;\sigma&space;=&space;1" target="_blank"><img src="https://latex.codecogs.com/svg.latex?\dpi{150}&space;\small&space;\sigma&space;=&space;1" title="\small \sigma = 1" /></a> |
| :---:         |     :---:      |   :---:   | :---:         |     :---:      |   :---:   |
| <a href="https://www.codecogs.com/eqnedit.php?latex=\dpi{150}&space;\small&space;\l_{1}" target="_blank"><img src="https://latex.codecogs.com/svg.latex?\dpi{150}&space;\small&space;\l_{1}" title="\small \l_{1}" /></a> norm | <img src="https://github.com/hjk92g/proper_measure_robustness/blob/master/results/Classifier_gradual_l1.png" width="145" height="145" /> | <img src="https://github.com/hjk92g/proper_measure_robustness/blob/master/results/Classifier_gradual_l1_1.png" width="145" height="145" /> |   <img src="https://github.com/hjk92g/proper_measure_robustness/blob/master/results/Classifier_gradual_l1_2.png" width="145" height="145" />   | <img src="https://github.com/hjk92g/proper_measure_robustness/blob/master/results/Classifier_gradual_l1_3.png" width="145" height="145" /> | <img src="https://github.com/hjk92g/proper_measure_robustness/blob/master/results/Classifier_gradual_l1_4.png" width="145" height="145" /> |
| <a href="https://www.codecogs.com/eqnedit.php?latex=\dpi{150}&space;\small&space;\l_{2}" target="_blank"><img src="https://latex.codecogs.com/svg.latex?\dpi{150}&space;\small&space;\l_{2}" title="\small \l_{2}" /></a> norm | <img src="https://github.com/hjk92g/proper_measure_robustness/blob/master/results/Classifier_gradual_l2.png" width="145" height="145" /> | <img src="https://github.com/hjk92g/proper_measure_robustness/blob/master/results/Classifier_gradual_l2_1.png" width="145" height="145" /> | <img src="https://github.com/hjk92g/proper_measure_robustness/blob/master/results/Classifier_gradual_l2_2.png" width="145" height="145" /> | <img src="https://github.com/hjk92g/proper_measure_robustness/blob/master/results/Classifier_gradual_l2_3.png" width="145" height="145" /> | <img src="https://github.com/hjk92g/proper_measure_robustness/blob/master/results/Classifier_gradual_l2_4.png" width="145" height="145" /> |
| <a href="https://www.codecogs.com/eqnedit.php?latex=\dpi{150}&space;\small&space;\l_{\infty}" target="_blank"><img src="https://latex.codecogs.com/svg.latex?\dpi{150}&space;\small&space;\l_{\infty}" title="\small \l_{\infty}" /></a> norm | <img src="https://github.com/hjk92g/proper_measure_robustness/blob/master/results/Classifier_gradual_linf.png" width="145" height="145" />  | <img src="https://github.com/hjk92g/proper_measure_robustness/blob/master/results/Classifier_gradual_linf_1.png" width="145" height="145" /> | <img src="https://github.com/hjk92g/proper_measure_robustness/blob/master/results/Classifier_gradual_linf_2.png" width="145" height="145" /> | <img src="https://github.com/hjk92g/proper_measure_robustness/blob/master/results/Classifier_gradual_linf_3.png" width="145" height="145" /> | <img src="https://github.com/hjk92g/proper_measure_robustness/blob/master/results/Classifier_gradual_linf_4.png" width="145" height="145" /> |



## `2D_genuine_Proj.py`: project points for calculation of genuine adversarial accuracy by maximum perturbation norm
* The function `gen_Proj(x_prime,x_nat,eps)` applies projections for calculating genuine adversarial accuracy based on maximum norm. `x_prime` indicates samples that will be applied projections, `x_nat` indicates clean samples and `eps` indicates epsilon that will be used for lp ball projection. 
* The function `gen_Proj2(x_prime,x_nats,eps)` applies projections for calculating genuine adversarial accuracy based on maximum norm. `x_nats` indicates clean samples and `m` nearest neighbors of clean samples (It needs to be concatenated along axis 1, i.e. the second axis.). The difference with `gen_Proj` is that this function use only `m` nearest neighbors for projection to roughly apply projection. As `gen_Proj2` uses only `m` nearest neighbors, it is faster and requires less memory.
* The code does not include gradient steps in projected gradient descent (PGD). For actual PGD calculation, one can apply gradient step (after random initialization), and then apply `gen_Proj` (or `gen_Proj2`) to project and iterate both gradient step and `gen_Proj` (or `gen_Proj2`) several times.

### Visualization of projection process with different distance metrics (after <a href="https://www.codecogs.com/eqnedit.php?latex=\dpi{150}&space;\small&space;Ball(x,\epsilon)" target="_blank"><img src="https://latex.codecogs.com/svg.latex?\dpi{150}&space;\small&space;Ball(x,\epsilon)" title="\small Ball(x,\epsilon)" /></a> projections)
| <a href="https://www.codecogs.com/eqnedit.php?latex=\dpi{150}&space;\small&space;\l_{1}" target="_blank"><img src="https://latex.codecogs.com/svg.latex?\dpi{150}&space;\small&space;\l_{1}" title="\small \l_{1}" /></a> norm | <a href="https://www.codecogs.com/eqnedit.php?latex=\dpi{150}&space;\small&space;\l_{2}" target="_blank"><img src="https://latex.codecogs.com/svg.latex?\dpi{150}&space;\small&space;\l_{2}" title="\small \l_{2}" /></a> norm | <a href="https://www.codecogs.com/eqnedit.php?latex=\dpi{150}&space;\small&space;\l_{\infty}" target="_blank"><img src="https://latex.codecogs.com/svg.latex?\dpi{150}&space;\small&space;\l_{\infty}" title="\small \l_{\infty}" /></a> norm |
| :---:        |     :---:      |   :---: |
| <img src="https://github.com/hjk92g/proper_measure_robustness/blob/master/gifs/Proj_points_l1.gif" width="290" height="290" /> | <img src="https://github.com/hjk92g/proper_measure_robustness/blob/master/gifs/Proj_points_l2.gif" width="290" height="290" /> | <img src="https://github.com/hjk92g/proper_measure_robustness/blob/master/gifs/Proj_points_linf.gif" width="290" height="290" /> |

### Visualization of projection results
| <a href="https://www.codecogs.com/eqnedit.php?latex=\dpi{150}&space;\small&space;\l_{1}" target="_blank"><img src="https://latex.codecogs.com/svg.latex?\dpi{150}&space;\small&space;\l_{1}" title="\small \l_{1}" /></a> norm | <a href="https://www.codecogs.com/eqnedit.php?latex=\dpi{150}&space;\small&space;\l_{2}" target="_blank"><img src="https://latex.codecogs.com/svg.latex?\dpi{150}&space;\small&space;\l_{2}" title="\small \l_{2}" /></a> norm | <a href="https://www.codecogs.com/eqnedit.php?latex=\dpi{150}&space;\small&space;\l_{\infty}" target="_blank"><img src="https://latex.codecogs.com/svg.latex?\dpi{150}&space;\small&space;\l_{\infty}" title="\small \l_{\infty}" /></a> norm |
| :---:       |     :---:      |  :---: |
| <img src="https://github.com/hjk92g/proper_measure_robustness/blob/master/results/Proj_points_l1.png" width="290" height="290" /> | <img src="https://github.com/hjk92g/proper_measure_robustness/blob/master/results/Proj_points_l2.png" width="290" height="290" /> | <img src="https://github.com/hjk92g/proper_measure_robustness/blob/master/results/Proj_points_linf.png" width="290" height="290" /> |

### Visualization of simple case of properly applied adversarial training
Properly applied adversarial training refers to adversarial training with no conflicting regions originating from overlapping regions (of different classes).
| <a href="https://www.codecogs.com/eqnedit.php?latex=\dpi{150}&space;\small&space;\l_{1}" target="_blank"><img src="https://latex.codecogs.com/svg.latex?\dpi{150}&space;\small&space;\l_{1}" title="\small \l_{1}" /></a> norm | <a href="https://www.codecogs.com/eqnedit.php?latex=\dpi{150}&space;\small&space;\l_{2}" target="_blank"><img src="https://latex.codecogs.com/svg.latex?\dpi{150}&space;\small&space;\l_{2}" title="\small \l_{2}" /></a> norm | <a href="https://www.codecogs.com/eqnedit.php?latex=\dpi{150}&space;\small&space;\l_{\infty}" target="_blank"><img src="https://latex.codecogs.com/svg.latex?\dpi{150}&space;\small&space;\l_{\infty}" title="\small \l_{\infty}" /></a> norm |
| :---:       |     :---:      |  :---: |
| <img src="https://github.com/hjk92g/proper_measure_robustness/blob/master/results/Proper_adversarial_l1.png" width="290" height="290" /> | <img src="https://github.com/hjk92g/proper_measure_robustness/blob/master/results/Proper_adversarial_l2.png" width="290" height="290" /> | <img src="https://github.com/hjk92g/proper_measure_robustness/blob/master/results/Proper_adversarial_linf.png" width="290" height="290" /> |
